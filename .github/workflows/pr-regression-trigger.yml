name: PR Comment Test Trigger

on:
  issue_comment:
    types: [created]

jobs:
  trigger-tests:
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '/run-tests')
    runs-on: ubuntu-latest

    steps:
      - name: Trigger test repo workflow
        env:
          TOKEN: ${{ secrets.QA_TRIGGER_TOKEN }}
        run: |
          curl -X POST \
            -H "Authorization: token $TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/ORG_NAME/test-repo/dispatches \
            -d '{
              "event_type": "run-tests",
              "client_payload": {
                "pr_number": "${{ github.event.issue.number }}",
                "sha": "${{ github.event.pull_request.head.sha }}"
              }
            }'
