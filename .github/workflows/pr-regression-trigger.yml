name: Selenium Test Executor

on:
  repository_dispatch:
    types: [run-selenium]

jobs:
  execute-selenium:
    runs-on: ubuntu-latest
    steps:
      - name: Extract payload values
        id: setup
        run: |
          echo "sha=${{ github.event.client_payload.sha }}" >> $GITHUB_OUTPUT
          echo "pr_number=${{ github.event.client_payload.pr_number }}" >> $GITHUB_OUTPUT
          echo "dev_repo_owner=${{ github.event.client_payload.dev_repo_owner }}" >> $GITHUB_OUTPUT
          echo "dev_repo_name=${{ github.event.client_payload.dev_repo_name }}" >> $GITHUB_OUTPUT

      - name: Post pending status to DEV repo
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DEV_REPO_TOKEN }}
          script: |
            // Always post to the latest PR head commit SHA
            await github.rest.repos.createCommitStatus({
              owner: '${{ steps.setup.outputs.dev_repo_owner }}',
              repo: '${{ steps.setup.outputs.dev_repo_name }}',
              sha: '${{ steps.setup.outputs.sha }}',
              state: 'pending',
              context: 'selenium-suite',
              description: 'Running Selenium tests...',
              target_url: '${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}'
            });

      # Run your Selenium tests here...
      # Example placeholder:
      - name: Run Selenium tests
        run: echo "Executing suite..."

      - name: Post success status to DEV repo
        if: success()
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DEV_REPO_TOKEN }}
          script: |
            await github.rest.repos.createCommitStatus({
              owner: '${{ steps.setup.outputs.dev_repo_owner }}',
              repo: '${{ steps.setup.outputs.dev_repo_name }}',
              sha: '${{ steps.setup.outputs.sha }}',
              state: 'success',
              context: 'selenium-suite',
              description: '✅ Selenium tests passed',
              target_url: '${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}'
            });

      - name: Post failure status to DEV repo
        if: failure()
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DEV_REPO_TOKEN }}
          script: |
            await github.rest.repos.createCommitStatus({
              owner: '${{ steps.setup.outputs.dev_repo_owner }}',
              repo: '${{ steps.setup.outputs.dev_repo_name }}',
              sha: '${{ steps.setup.outputs.sha }}',
              state: 'failure',
              context: 'selenium-suite',
              description: '❌ Selenium tests failed',
              target_url: '${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}'
            });
